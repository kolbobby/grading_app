$('#main-user-content').html("<div class='row'><%= escape_javascript(render 'add_activity_form') %></div>");

var cur_coach = $('input[name=coaches]:radio').val();
$('input[name=coaches]:radio').change(function() {
	cur_coach = $(this).val();
	$.post('/change_coach', { coach: cur_coach }, function(r) { loadActivities(r); });
});

$('#manage-activities').children('tbody').children('tr').children('td').dblclick(function() {
	if(!$(this).hasClass('left-side')) {
		$(this).html("<input type='text' value=" + $(this).text() + " />");
	}
});
$('#edit-all-activities').click(function() {
	$('#manage-activities').children('tbody').children('tr').children('td').each(function() {
		if(!$(this).hasClass('left-side')) {
			$(this).html("<input type='text' value=" + $(this).text() + " />");
		}
	});
});
$('#save-activities').click(function() {
	if($('#manage-activities').children('tbody').children('tr').children('td').children('input').length) {
		var moveOn = true;
		$('#manage-activities').children('tbody').children('tr').children('td.data').each(function() {
			if($(this).children('em').html() == 'none') {
				moveOn = false;
			}
		});

		if(moveOn) {
			//ADD ACTIVITIES TO DB HERE
			$('#manage-activities').children('tbody').children('tr').children('td.data').each(function() {
				var id = $(this).prop('id');
				var mp = id.substring(0, 1);
				var act = id.substring(2);
				alert(mp + ": " + act);
			});
		}

		$.post('/change_coach', { coach: cur_coach }, function(r) { loadActivities(r); });
	}
});

function loadActivities(activities) {
	var str = "";
	if(activities.length < 12) {
		for(var i = 0;i < 4;i++) {
			str += "<tr>";
			str += "<td class='left-side'>Marking Period "+ (i+1) +"</td>";
			for(var j = 0;j < 3;j++) {
				var text = "";
				if(j != 2) {
					if(activities.length < 12) {
						str += "<td id='"+(i+1)+"_"+(j+1)+"' class='data'><em>none</em></td>";
					} else {
						$.post('/get_activities', { act: j+1, mp: i+1 }, function(r) { text = r; });
						str += "<td id='"+(i+1)+"_"+(j+1)+"' class='data'>"+ text +"</td>";
					}
				} else {
					if(activities.length < 12) {
						str += "<td id='"+(i+1)+"_"+(j+1)+"' class='right-side data'><em>none</em></td>";
					} else {
						$.post('/get_activities', { act: j+1, mp: i+1 }, function(r) { text = r; });
						str += "<td id='"+(i+1)+"_"+(j+1)+"' class='right-side data'>"+ text +"</td>";
					}
				}
			}
			str += "</tr>";
		}
	}
	$("#manage-activities").children('tbody').html(str);

	$.each(activities, function() {
		$.each(this, function(key, value) {
			alert(key + ": " + value);
		});
	});
}